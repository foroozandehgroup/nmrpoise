
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Setting up a Routine &#8212; poise  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Running an optimisation" href="../running/" />
    <link rel="prev" title="Installation" href="../install/" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="setting-up-a-routine">
<h1>Setting up a Routine<a class="headerlink" href="#setting-up-a-routine" title="Permalink to this headline">¶</a></h1>
<p>If you’re coming here from the <a class="reference internal" href="../install/"><span class="doc">Installation</span></a>, you should make sure that POISE has been installed correctly.
A simple check is to type in <code class="docutils literal notranslate"><span class="pre">poise</span> <span class="pre">-l</span></code> into the TopSpin command line: if it shows a text box, then you should be good to go.</p>
<p>Each optimisation in POISE is controlled by a <strong>routine</strong>, which contains all information necessary for an optimisation.
The ingredients of a routine are:</p>
<blockquote>
<div><ul class="simple">
<li><p>A name</p></li>
<li><p>The parameters to be optimised</p></li>
<li><p>Lower bounds, upper bounds, initial values, and tolerances for each parameter</p></li>
<li><p>A cost function which determines the ‘badness’ of a spectrum</p></li>
<li><p><em>(Optional)</em> The name of an AU programme for acquisition and processing</p></li>
</ul>
</div></blockquote>
<p>We will now walk through how to set a routine up, elaborating on each of these ingredients as we come to them.
To get this process started, type <code class="docutils literal notranslate"><span class="pre">poise</span></code> into the TopSpin command line.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>POISE has a number of command-line options. If you’re interested in finding out more about these, <code class="docutils literal notranslate"><span class="pre">poise</span> <span class="pre">-h</span></code> will give you a short summary of each of them, and <a class="reference internal" href="../frontend/"><span class="doc">Frontend options</span></a> has additional info.</p>
</div>
<hr class="docutils" />
<p>The routine we will set up now is one for the calibration of the 360° pulse width.
The first ingredient we need to provide is a <strong>name</strong>.
I’ve used <code class="docutils literal notranslate"><span class="pre">p1cal</span></code> for this, but of course you can choose anything you prefer:</p>
<img alt="../_images/routine1.png" class="align-center" src="../_images/routine1.png" />
<p>After clicking OK, you will be prompted to provide the <strong>parameters</strong> that are being optimised.
Here we are just optimising one parameter, <code class="docutils literal notranslate"><span class="pre">p1</span></code>.</p>
<img alt="../_images/routine2.png" class="align-center" src="../_images/routine2.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only parameters that take on float values can be optimised (pulses <code class="docutils literal notranslate"><span class="pre">p</span></code>, delays <code class="docutils literal notranslate"><span class="pre">d</span></code>, constants <code class="docutils literal notranslate"><span class="pre">cnst</span></code>…) Integer values, like <code class="docutils literal notranslate"><span class="pre">td</span></code> or loop counters <code class="docutils literal notranslate"><span class="pre">l</span></code>, will not work.</p>
</div>
<p>At this stage, you will be prompted to enter the <strong>bounds</strong>, <strong>initial value</strong>, and <strong>tolerances</strong>.
The lower and upper bounds simply reflect a range within which the optimum can reasonably be assumed to lie within, and the initial value should be your best guess at where the optimum is.</p>
<p>On the spectrometer we’re currently using, the Prosol value for a 90° pulse is 12 µs, so we’ll go ahead and set the initial guess for the 360° pulse to be 48 µs.
<em>(If your Prosol value differs, you should adjust these values accordingly.)</em>
The lower and initial bounds can be 40 and 56 µs respectively, corresponding to a 90° pulse of between 10 and 14 µs.
The tolerance, on the other hand, roughly reflects the degree of accuracy that you want in the answer. Here we’ve used a value of 0.2 µs.</p>
<img alt="../_images/routine3.png" class="align-center" src="../_images/routine3.png" />
<p>Choosing tolerances can be tricky sometimes.
Too large a tolerance can lead to inaccurate answers (as the optimisation converges before it’s really found the minimum); and too small a tolerance is meaningless, as often the resulting spectra are barely different.
Generally, it’s a good idea to choose the smallest value where going in either direction will give you an appreciable difference in the spectrum.
However, it doesn’t have to be <em>too</em> precise: as long as you aren’t off by an order of magnitude POISE will still work reasonably well.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default TopSpin units for pulse lengths are microseconds, so the unitless <code class="docutils literal notranslate"><span class="pre">48</span></code> is equal to 48 µs. However, for delays the default units are seconds.</p>
<p>POISE also allows you to specify units using the suffixes ‘u’, ‘m’, and ‘s’ for microseconds, milliseconds, and seconds respectively. This is designed to mimic TopSpin’s parameter settings, where <code class="docutils literal notranslate"><span class="pre">30m</span></code> means 30 ms (for example). So you can enter <code class="docutils literal notranslate"><span class="pre">48u</span></code> in this screen as well, or indeed <code class="docutils literal notranslate"><span class="pre">0.048m</span></code>.</p>
</div>
<p>Finally, we have to choose a <strong>cost function</strong>, as well as (optionally) an <strong>AU programme</strong>.</p>
<p>The cost function is a Python function which reads the spectrum and returns a <em>‘cost’</em>, i.e. how bad the spectrum is.
All optimisations in POISE seek to minimise the cost function.
In our case, the best value of <code class="docutils literal notranslate"><span class="pre">p1</span></code> is one for which the intensity of a pulse-acquire spectrum (<code class="docutils literal notranslate"><span class="pre">zg</span></code>) is minimised, i.e. magnetisation is returned to the positive <em>z</em>-axis.
So, we can conveniently use the intensity of the magnitude-mode spectrum as the cost function.
This cost function is also bundled with POISE, and is called <code class="docutils literal notranslate"><span class="pre">minabsint</span></code>.
(For those who are familiar with TopSpin’s built-in <code class="docutils literal notranslate"><span class="pre">popt</span></code>, this is equivalent to the <code class="docutils literal notranslate"><span class="pre">MAGMIN</span></code> criterion.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information about the built-in cost functions, check out <a class="reference internal" href="../costfunctions/"><span class="doc">Builtin cost functions</span></a>.</p>
</div>
<p>The AU programme controls spectrum acquisition and processing, and can be left blank in this case.
All we need to do for this routine is to acquire the spectrum, Fourier transform, then perform phase and baseline correction.
For 1D and 2D datasets, if the AU programme option is left blank, POISE will automatically do exactly these steps.
Therefore, there is no need to specify an AU programme unless you want to customise this process.</p>
<img alt="../_images/routine4.png" class="align-center" src="../_images/routine4.png" />
<p>That’s it — congratulations, you’ve set up a POISE routine!
If you type <code class="docutils literal notranslate"><span class="pre">poise</span> <span class="pre">-l</span></code> now, you should now see the <code class="docutils literal notranslate"><span class="pre">p1cal</span></code> routine (or whatever you named it) appear in the text box:</p>
<img alt="../_images/routine5.png" class="align-center" src="../_images/routine5.png" />
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../">poise</a></h1>








<p></p>
<h3>Useful links</h3>
<ul>
    <li><a href="https://doi.org/10.1021/acs.analchem.1c01767">Paper (<i>Anal. Chem.</i> 2021)</a></li>
    <li><a href="https://arxiv.org/abs/2108.07121">arXiv preprint</a></li>
    <li><a href="https://github.com/foroozandehgroup/nmrpoise">GitHub repository</a></li>
    <li><a href="https://www.youtube.com/watch?v=QTCeSCRZs4I">YouTube video guide</a></li>
    <li><a href="https://foroozandehgroup.github.io/nmrpoise">HTML documentation</a></li>
    <li><a href="https://foroozandehgroup.github.io/nmrpoise/poise.pdf">PDF documentation</a></li>
</ul><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setting up a Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running/">Running an optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend/">Frontend options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../automation/">POISE under automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../costfunctions/">Builtin cost functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../au/">Builtin AU programmes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customcf/">Custom cost functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/">Developer notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../">Documentation overview</a><ul>
      <li>Previous: <a href="../install/" title="previous chapter">Installation</a></li>
      <li>Next: <a href="../running/" title="next chapter">Running an optimisation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021–2022, Jonathan Yong & Mohammadali Foroozandeh.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/routines.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>